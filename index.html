<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/white.css">

                <link rel="stylesheet" href="diagram.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/github.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
				  <h2>DNF5</h2>
				  <h3>The new era in RPM software management</h3>
				</section>

                                <section>
                                    <h3>Introduction</h3>
                                    <ol>
                                        <li>Technical part - Aleš Matěj</li>
                                        <li>Community part - Nicola Sella</li>
                                        <li>Demo - Jan Kolárik</li>
                                    </ol>
                                </section>

                                <section>
                                    <h3>What is a package manager?</h3>
                                    <ul>
                                        <li>Something like a free command line app-store (backend)</li>
                                        <li>It installs, upgrades and removes packages, handles metadata, resolves dependencies…)</li>
                                        <li>Examples: DNF, microdnf, YUM, APT, PACMAN </li>
                                        <li>(vs. dpkg, rpm)</li>
                                    </ul>
                                </section>

                                <section data-auto-animate style="padding: 100px;">
                                    <div id="libdnf" data-id="box">
                                        <div style="float:left; width: 40%;">
                                            <div id="hawkey" data-id="box">hawkey</div>
                                            <div id="python-hawkey" data-id="box">python-hawkey</div>
                                        </div>

                                        <div style="float: left; width: 20%; text-align:center; ">
                                            <span style="">LIBDNF</span>
                                        </div>
                                        <div data-id="box" style="float:left; width: 40%; height: 200px;">
                                            <div id="libhif" >libhif</div>
                                        </div>

                                    </div>
                                    <div id="plugins-libhif" class="plugins" data-id="box">Plugins</div>
                                    <div class="clearfix"></div>

                                    <div id="dnf" data-id="box">dnf</div>
                                    <div id="plugins-dnf" class="plugins" data-id="box">Plugins</div>
                                    <div id="microdnf" data-id="box">microdnf</div>
                                    <div id="packagekit" data-id="box">PackageKit</div>
                                    <svg style="position: fixed; top:-100px; left:-100px;" width="1000" height="1000" >
                                        <-- hawkey--python-hawkey -->
                                        <line x1="350" y1="320" x2="350" y2="350" style="stroke:#e59728;stroke-width:3" />
                                        <-- dnf--python-hawkey -->
                                        <line x1="350" y1="470" x2="350" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- dnf--plugins -->
                                        <line x1="122" y1="590" x2="175" y2="590" style="stroke:#79db32;stroke-width:3" />
                                        <-- libhif--plugins -->
                                        <line x1="825" y1="362" x2="925" y2="362" style="stroke:#79db32;stroke-width:3" />
                                        <-- microdnf--hawkey -->
                                        <line x1="455" y1="290" x2="550" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- microdnf--libhif -->
                                        <line x1="750" y1="470" x2="550" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- packagekit--hawkey -->
                                        <line x1="455" y1="290" x2="750" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- packagekit--libhif -->
                                        <line x1="750" y1="470" x2="750" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                    </svg>
                                    <div id="dnf5-intro" style="opacity:0;">
                                        <h1 style="color: black;">DNF5</h1>
                                    </div>
                                </section>

                                <section data-auto-animate style="padding: 100px;">
                                    <div id="libdnf" data-id="box">
                                        <div style="float:left; width: 40%;">
                                            <div id="hawkey" data-id="box">hawkey</div>
                                            <div id="python-hawkey" data-id="box">python-hawkey</div>
                                        </div>

                                        <div style="float: left; width: 20%; text-align:center; ">
                                            <span style="">LIBDNF</span>
                                        </div>
                                        <div data-id="box" style="float:left; width: 40%; height: 200px;">
                                            <div id="libhif" >libhif</div>
                                        </div>

                                    </div>
                                    <div id="plugins-libhif" class="plugins" data-id="box">Plugins</div>
                                    <div class="clearfix"></div>

                                    <div id="dnf" data-id="box">dnf</div>
                                    <div id="plugins-dnf" class="plugins" data-id="box">Plugins</div>
                                    <div id="microdnf" data-id="box">microdnf</div>
                                    <div id="packagekit" data-id="box" >PackageKit</div>
                                    <svg style="position: fixed; top:-100px; left:-100px;" width="1000" height="1000" >
                                        <-- hawkey--python-hawkey -->
                                        <line x1="350" y1="320" x2="350" y2="350" style="stroke:#e59728;stroke-width:3" />
                                        <-- dnf--python-hawkey -->
                                        <line x1="350" y1="470" x2="350" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- dnf--plugins -->
                                        <line x1="122" y1="590" x2="175" y2="590" style="stroke:#79db32;stroke-width:3" />
                                        <-- libhif--plugins -->
                                        <line x1="825" y1="362" x2="925" y2="362" style="stroke:#79db32;stroke-width:3" />
                                        <-- microdnf--hawkey -->
                                        <line x1="455" y1="290" x2="550" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- microdnf--libhif -->
                                        <line x1="750" y1="470" x2="550" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- packagekit--hawkey -->
                                        <line x1="455" y1="290" x2="750" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- packagekit--libhif -->
                                        <line x1="750" y1="470" x2="750" y2="560" style="stroke:#a07cbc;stroke-width:3" />
                                    </svg>
                                    <div id="dnf5-intro" style="opacity:90%;">
                                        <h1 style="color: black;">DNF5</h1>
                                    </div>
                                </section>

                                <section data-auto-animate style="padding: 100px;">
                                    <div id="libdnf" data-id="box">
                                        <div style="float:left; width: 40%;">
                                            <div id="libdnf" data-id="box" style="opacity:0%;">hawkey</div>
                                            <div id="python-hawkey" data-id="box" style="opacity:0%;">python-hawkey</div>
                                        </div>

                                        <div style="float: left; width: 20%; padding: 100px 0 0 0;">
                                            <span style="">LIBDNF5</span>
                                        </div>
                                        <div data-id="box" style="float:left; width: 40%; height: 100%; opacity:0;">
                                            <div id="libhif" >libhif</div>
                                        </div>

                                    </div>
                                    <div id="plugins-libhif" class="plugins" data-id="box">Plugins</div>
                                    <div class="clearfix"></div>

                                    <div id="dnf" data-id="box">dnf5</div>
                                    <div id="plugins-dnf" class="plugins" data-id="box">Plugins</div>
                                    <div id="microdnf" data-id="box" style="opacity:0;">microdnf</div>
                                    <div id="packagekit" data-id="box">dnf5 daemon</div>
                                    <svg style="position: fixed; top:-100px; left:-100px;" width="1000" height="1000" >
                                        <-- dnf--libdnf5 -->
                                        <line x1="350" y1="495" x2="350" y2="550" style="stroke:#a07cbc;stroke-width:3" />
                                        <-- libdnf5--plugins -->
                                        <line x1="880" y1="362" x2="925" y2="362" style="stroke:#79db32;stroke-width:3" />
                                        <-- dnf5--plugins -->
                                        <line x1="122" y1="590" x2="175" y2="590" style="stroke:#79db32;stroke-width:3" />
                                        <-- deamon--libhif -->
                                        <line x1="750" y1="495" x2="750" y2="550" style="stroke:#a07cbc;stroke-width:3" />
                                    </svg>
                                    <div id="dnf5-intro" style="opacity:0;">
                                        <h1 style="color: black;">DNF5</h1>
                                    </div>
                                </section>


                                <section>
                                    <img data-src="cat_meme.jpg">
                                </section>

                                <section style="text-align: left;">
                                    <h4>Basically full rewrite: API not compatible</h4>
                                    <ul>
                                        <li>API is safer and unified</li>
                                        <li>SWIG bindings for: <b>Python</b>, Perl, Ruby, <span style="opacity: 20%;">Go</span></li>
                                    </ul>
                                    <br><br>
                                    <h4>DNF5 CLI commands are mostly the same</h4>
                                    <ul>
                                        <li>DNF CI tests are the same for DNF5</li>
                                        <li>Outputs of commands did change</li>
                                    </ul>
                                </section>

                                <section style="text-align: left;">
                                    <h4>Performance</h4>
                                    <ul>
                                        <li>Repos download and loading at the same time (also no filelists)</li>
                                        <li>Faster repoquery</li>
                                    </ul>
                                    <br><br>
                                    <h4>Fewer dependencies</h4>
                                    <ul>
                                        <li>No Python required</li>
                                    </ul>
                                    <br><br>
                                    <h4>DNF5 daemon</h4>
                                    <ul>
                                        <li>Same functionality as dnf5</li>
                                    </ul>
                                </section>

                                <section>
                                    <h4>List of additional DNF5 improvements:</h4>
                                    <ul>
                                        <li>Configurable aliases</li>
                                        <li>Fully integrated Modularity in LIBDNF5 workflows</li>
                                        <li>Shared configurations</li>
                                        <li>Separation of system state from history DB and module state</li>
                                        <li>Autocomplete build in</li>
                                    </ul>
                                </section>

                                <section>
                                    <section>
                                        <h2>Community</h2>
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <h4>Where are we now?</h4>
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <img src="img/community/bimonthly_contrib.png" />
                                    </section>
                                    <section>
                                        <img src="img/community/commits_in_2022.png" />
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <img src="img/community/authors_per_contributions.png" />
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <h4>Where do we want to go?</h4>
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <img src="img/community/contributions_per_author_yum.png" />
                                    </section>
                                    <section>
                                        <img src="img/community/contributions_per_author_dnf5.png" />
                                    </section>
                                    <section>
                                        <img src="img/community/contributions_per_author_dnf.png" />
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <h4>Contributors, who are they?</h4>
                                        <ul>
                                            <li class="fragment fade-in" data-fragment-index="1">🏆: did ~10% commits</li>
                                            <li class="fragment fade-in" data-fragment-index="2">🏅: did ~100 commits</li>
                                            <li class="fragment fade-left" data-fragment-index="4"><b>🤔: The People in the Middle</b></li>
                                            <li class="fragment fade-up" data-fragment-index="3">🧩:one timers</li>
                                        </ul>
                                    </section>
                                    <section>
                                        <h4>DNF Contributors</h4>
                                        <table>
                                            <tr>
                                                <th></th>
                                                <th>Total (225)</th>
                                                <th>4 🏆 (1.7%)</th>
                                                <th>19 🏅 (0.8%)</th>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td></td>
                                                <td>9347</td>
                                                <td>3944</td>
                                                <td>1156</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 1%</td>
                                                <td>~80</td>
                                                <td>~40</td>
                                                <td>~11</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 5%</td>
                                                <td>~500</td>
                                                <td>~190</td>
                                                <td>~50</td>
                                            </tr>
                                        </table>
                                    </section>
                                    <section>
                                        <h4>DNF5 Contributors</h4>
                                        <table>
                                            <tr>
                                                <th></th>
                                                <th>Total (19)</th>
                                                <th>5 🏆 (16%)</th>
                                                <th>6 🏅 (9.9%)</th>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td></td>
                                                <td>1981</td>
                                                <td>336</td>
                                                <td>197</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 1%</td>
                                                <td>~20</td>
                                                <td>~&lt;4</td>
                                                <td>~&lt;2</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 5%</td>
                                                <td>~100</td>
                                                <td>~16</td>
                                                <td>~10 </td>
                                            </tr>
                                        </table>
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <h2>Live DEMO</h2>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>CLI DEMO</h4>
                                        <div style="display: flex;">
                                            <div style="flex: 50%;">
                                                <p>DNF</p>
                                            </div>
                                            <div style="flex: 50%;">
                                                <p>DNF5</p>
                                            </div>
                                        </div>
                                        <div style="display: flex; height: 490px; overflow: hidden;">
                                            <div style="flex: 50%; overflow: hidden;">
                                                <iframe src="http://localhost:6125" frameBorder="0" scrolling="no" style="max-width: 104%; width: 104%; height: 100%;"></iframe>
                                            </div>
                                            <div style="flex: 50%; overflow: hidden;">
                                                <iframe src="http://localhost:6126" frameBorder="0" scrolling="no" style="max-width: 104%; width: 104%; height: 100%;"></iframe>
                                            </div>
                                        </div>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>API DEMO 1</h4>
                                        <pre style="font-size: 20px; width: 100%; max-height: 474px; height: 474px;">
                                            <code class="hljs language-python" data-trim data-line-numbers="|1-4|6-11|13-16|18|">
from libdnf5 import *

my_base = base.Base()
history = transaction.TransactionHistory(my_base)

ts_cond = lambda ts: \
    ts.get_state() == transaction.TransactionState_OK

pkg_cond = lambda pkg: \
    pkg.get_action() == transaction.TransactionItemAction_INSTALL and \
    pkg.get_repoid() == 'updates'

pkgs = []
for ts in filter(ts_cond, history.list_all_transactions()):
    for pkg in filter(pkg_cond, ts.get_packages()):
        pkgs.append(pkg.to_string())

print(*sorted(pkgs), sep='\n')
                                            </code>
                                        </pre>
                                        <iframe src="http://localhost:6127" frameBorder="0" scrolling="no" style="max-width: 104%; width: 104%; height: 100%;"></iframe>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>API DEMO 2</h4>
                                        <pre style="font-size: 18px; width: 100%; max-height: 494px; height: 494px;">
                                            <code class="hljs language-python" data-trim data-line-numbers="|3-4|6-8|10-12|14-17|19-21|">
from libdnf5 import *

my_base = base.Base()
my_base.setup()

repo_sack = my_base.get_repo_sack()
repo_sack.create_repos_from_system_configuration()
repo_sack.update_and_load_enabled_repos(False)

goal = base.Goal(my_base)
goal.add_rpm_install("zlib")
ts = goal.resolve()

downloader = repo.PackageDownloader()
for pkg in ts.get_transaction_packages():
    if base.transaction.transaction_item_action_is_inbound(pkg.get_action()):
        downloader.add(pkg.get_package(), "download")

print("Download started ...")
downloader.download(True, True)
print("Download finished.")

                                            </code>
                                        </pre>
                                        <iframe src="http://localhost:6127" frameBorder="0" scrolling="no" style="max-width: 104%; width: 104%; height: 100%;"></iframe>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Interactive console</h4>
                                        <div style="height: 600px;">
                                            <iframe src="http://localhost:6128" frameBorder="0" scrolling="no" style="width: 100%; height: 100%;"></iframe>
                                        </div>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p class="fragment">What do we need?</p>
                                        <ul class="fragment fade-up">
                                            <li>Devel package</li>
                                            <li>Template sources</li>
                                            <li>Build tools (f.e. CMake)</li>
                                        </ul>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>How to write it?</p>
                                        <ul class="fragment fade-up">
                                            <li>Definition</li>
                                            <li>Implementation</li>
                                            <li>Adapter A.K.A. boilerplate</li>
                                        </ul>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>Implementation</p>
                                        <pre style="font-size: 16px; width: 100%; max-height: 512px; height: 512px;">
                                            <code class="hljs language-cpp" data-trim data-line-numbers="|9-12|15-17|19-21|23-25|">
<script type="text/template">
#include "example.hpp"

#include <iostream>

namespace dnf5 {

using namespace libdnf::cli;

void ExampleCommand::set_parent_command() {
    auto parent_command = get_session().get_argument_parser().get_root_command();
    auto this_command = get_argument_parser_command();
    parent_command->register_command(this_command);
}

void ExampleCommand::set_argument_parser() {
    get_argument_parser_command()->set_description("Example command");
}

void ExampleCommand::configure() {
    get_context().set_quiet(true);
}

void ExampleCommand::run() {
    std::cout << "YES !!! We did it!" << std::endl;
}
</script>
                                            </code>
                                        </pre>
                                    </section>
                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>Adapter</p>
                                        <pre style="font-size: 16px; width: 100%; max-height: 512px; height: 512px;">
                                            <code class="hljs language-cpp" data-trim data-line-numbers="|9-13|41-44|61-65">
<script type="text/template">
#include "example.hpp"

#include <dnf5/iplugin.hpp>

using namespace dnf5;

namespace {

constexpr const char * PLUGIN_NAME{"example"};
constexpr PluginVersion PLUGIN_VERSION{.major = 1, .minor = 0, .micro = 0};

constexpr const char * attrs[]{"author.name", "author.email", "description", nullptr};
constexpr const char * attrs_value[]{"Some Excited Guy", "sponsor@dnf5.com", "example"};

class ExamplePlugin : public IPlugin {
public:
    using IPlugin::IPlugin;

    PluginAPIVersion get_api_version() const noexcept override { return PLUGIN_API_VERSION; }

    const char * get_name() const noexcept override { return PLUGIN_NAME; }

    PluginVersion get_version() const noexcept override { return PLUGIN_VERSION; }

    const char * const * get_attributes() const noexcept override { return attrs; }

    const char * get_attribute(const char * attribute) const noexcept override {
        for (size_t i = 0; attrs[i]; ++i) {
            if (std::strcmp(attribute, attrs[i]) == 0) {
                return attrs_value[i];
            }
        }
        return nullptr;
    }

    std::vector<std::unique_ptr<Command>> create_commands() override;

    void finish() noexcept override {}
};

std::vector<std::unique_ptr<Command>> ExamplePlugin::create_commands() {
    std::vector<std::unique_ptr<Command>> commands;
    commands.push_back(std::make_unique<ExampleCommand>(get_context()));
    return commands;
}

}

PluginAPIVersion dnf5_plugin_get_api_version(void) {
    return PLUGIN_API_VERSION;
}

const char * dnf5_plugin_get_name(void) {
    return PLUGIN_NAME;
}

PluginVersion dnf5_plugin_get_version(void) {
    return PLUGIN_VERSION;
}

IPlugin * dnf5_plugin_new_instance(ApplicationVersion version, Context & context) try {
    return new ExamplePlugin(context);
} catch(...) {
    return nullptr;
}

void dnf5_plugin_delete_instance(IPlugin * plugin_object) {
    delete plugin_object;
}
</script>
                                            </code>
                                    </section>
                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>Build it & run it!</p>
                                        <div style="height: 500px;">
                                            <iframe src="http://localhost:6129" frameBorder="0" scrolling="no" style="width: 100%; height: 100%;"></iframe>
                                        </div>
                                    </section>
                            </section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
