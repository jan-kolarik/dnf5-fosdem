<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/white.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/github.css">

        <!-- Diagrams stylesheets -->
        <link rel="stylesheet" href="custom/dnf-diagram.css">
        <link rel="stylesheet" href="custom/pkg-mgr-diagram.css">

        <style>
            .reveal {
                --r-background-color: #919191;
                --r-heading-color: #333333;
                --r-main-color: #474747;
                --r-link-color: #1197c7;
                --r-link-color-hover: #126a8f;
                --r-selection-color: #474747;
                --r-selection-background-color: #70c0dd;
            }
            .reveal .footer {
                position: absolute;
                bottom: 3%;
                left: 3%;
                font-size: 0.6em;
            }
            .reveal .mid-footer {
                position: absolute;
                bottom: 3%;
                left: 42%;
                font-size: 0.6em;
            }
            .reveal .fosdem-logo {
                position: absolute;
                bottom: 87%;
                left: 3%;
                width: 6em;
            }

            .reveal .opaque {
                opacity:0.4;
                filter: alpha(opacity=60);
            }
            .reveal .opaque:hover {
                opacity:1;
                filter: alpha(opacity=100);
            }
            .reveal .zindex-1 {
                z-index: 1;
            }

            .reveal .crop-graph {
                margin-top: -8%;
            }

            .reveal table.smaller {
                font-size: 0.5em;
            }
        </style>
	</head>
	<body>
		<div class="reveal">
            <div class='footer opaque zindex-1'>
                <p>
                    <a href="https://github.com/rpm-software-management/dnf5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                        </svg> dnf5
                    </a>
                </p>
                  <p>Aleš Matěj - Nicola Sella - Jan Kolárik</p>
            </div>
            <div class='mid-footer opaque zindex-1'>
            </div>
            <div class='fosdem-logo opaque zindex-1'>
                <a href="https://fosdem.org/2023/schedule/event/dnf5/" target="_blank">
                    <img class="logo" src="img/logo/DNF_fosdem_logo.png">
                </a>
            </div>
			<div class="slides">
				<section>
				  <h2>DNF5</h2>
                  <div class="r-stack">
                    <span class="fragment fade-left fade-out" data-fragment-index="2">
                        <h4>The new era in RPM software management</h4>
                    </span>
		            <h4 class="fragment fade-left" data-fragment-index="2">
                    How we rewrote the codebase and started loving the community</h4>
                  </div>
                  <p class="fragment fade-left">Aleš Matěj - Nicola Sella - Jan Kolárik</p>
				</section>

                                <section>
                                    <h3>Introduction</h3>
                                    <ol>
                                        <li class="fragment fade-left">Technical part - Aleš Matěj</li>
                                        <li class="fragment fade-left">Community part - Nicola Sella</li>
                                        <li class="fragment fade-left">Demo - Jan Kolárik</li>
                                    </ol>
                                </section>

                                <section>
                                    <section data-auto-animate>
                                        <h3>What is a package manager?</h3>
                                        <ul>
                                            <li class="fragment fade-left">Something like a command line app-store (backend)</li>
                                            <li class="fragment fade-left">It installs, upgrades and removes packages, handles metadata, resolves dependencies…)</li>
                                            <li class="fragment fade-left">Examples: DNF, microdnf, YUM, APT, PACMAN</li>
                                        </ul>
                                    </section>

                                    <section data-auto-animate data-auto-animate-duration="0.5" id="pkg-mgr-diagram-slide" data-state="pkg-mgr-diagram">
                                        <h3>What is a package manager?</h3>
                                        <div data-id="pkg-mgr-diagram">
                                            <div id="pkg-manager-diagram-grid">
                                                <div id="pkg-gui-user" class="pkg-mgr-diagram-block">
                                                    <img data-src="img/tech/display.png" style="height: 80px; margin: 0;">
                                                    <p style="margin: 0;">GUI user</p>
                                                </div>
                                                <div id="pkg-cli-user" class="pkg-mgr-diagram-block">
                                                    <img data-src="img/tech/gnome-terminal.svg" style="height: 80px; margin: 0;">
                                                    <p style="margin: 0;">CLI user</p>
                                                </div>
                                                <div id="sw-center" class="pkg-mgr-diagram-block">
                                                    <img data-src="img/tech/gnome-software.svg" style="height: 80px; margin: 0;">
                                                    <p style="margin: 0;">Software Center</p>
                                                </div>
                                                <div id="pkgkit" class="pkg-mgr-diagram-block">PackageKit</div>
                                                <div id="pkg-high-manager" class="pkg-mgr-diagram-block">High Level Manager</div>
                                                <div id="pkg-high-manager-list" style="font-size: 50%;">DNF, APT, pacman</div>
                                                <div id="pkg-low-manager" class="pkg-mgr-diagram-block">Low Level Manager</div>
                                                <div id="pkg-low-manager-list" style="font-size: 50%;">RPM, dpkg</div>
                                            </div>
                                            <div id="pkg-gui-user_sw-center" class="pkg-mgr-diagram-line"></div>
                                            <div id="sw-center_pkgkit" class="pkg-mgr-diagram-line"></div>
                                            <div id="pkgkit_pkg-high-manager" class="pkg-mgr-diagram-line"></div>
                                            <div id="pkg-high-manager_pkg-low-manager" class="pkg-mgr-diagram-line"></div>
                                            <div id="pkg-cli-user_pkg-high-manager" class="pkg-mgr-diagram-line"></div>
                                            <div id="pkg-cli-user_pkg-low-manager" class="pkg-mgr-diagram-line pkg-mgr-diagram-dash-line"></div>
                                        </div>
                                    </section>
                                </section>

                                <section>
                                    <section data-auto-animate data-state="dnf-diagram">
                                        <div class="r-stack">
                                            <div data-id="dnf-diagram">
                                                <div id="dnf-diagram-grid">
                                                    <div id="libdnf" class="dnf-diagram-block">
                                                        <div id="libdnf-grid">
                                                            <div id="libdnf-label"><b>LIBDNF</b></div>
                                                            <div id="hawkey" class="dnf-diagram-block">hawkey</div>
                                                            <div id="python-hawkey" class="dnf-diagram-block">python-hawkey</div>
                                                            <div id="libhif" class="dnf-diagram-block">libhif</div>
                                                        </div>
                                                    </div>
                                                    <div id="dnf-plugins" class="dnf-diagram-block">plugins</div>
                                                    <div id="dnf" class="dnf-diagram-block">dnf</div>
                                                    <div id="microdnf" class="dnf-diagram-block">microdnf</div>
                                                    <div id="packagekit" class="dnf-diagram-block">PackageKit</div>
                                                    <div id="libdnf-plugins" class="dnf-diagram-block">plugins</div>
                                                </div>
                                                <div id="dnf_dnf-plugins" class="dnf-diagram-line"></div>
                                                <div id="dnf_python-hawkey" class="dnf-diagram-line"></div>
                                                <div id="python-hawkey_hawkey" class="dnf-diagram-line"></div>
                                                <div id="microdnf_hawkey" class="dnf-diagram-line"></div>
                                                <div id="packagekit_hawkey" class="dnf-diagram-line"></div>
                                                <div id="libhif_microdnf" class="dnf-diagram-line"></div>
                                                <div id="libhif_packagekit" class="dnf-diagram-line"></div>
                                                <div id="libhif_libdnf-plugins" class="dnf-diagram-line"></div>
                                            </div>
                                        </div>
                                    </section>

                                    <section data-auto-animate>
                                        <div class="r-stack">
                                            <div data-id="dnf-diagram" style="opacity: 0.15 !important">
                                                <div id="dnf-diagram-grid">
                                                    <div id="libdnf" class="dnf-diagram-block">
                                                        <div id="libdnf-grid">
                                                            <div id="libdnf-label"><b>LIBDNF</b></div>
                                                            <div id="hawkey" class="dnf-diagram-block">hawkey</div>
                                                            <div id="python-hawkey" class="dnf-diagram-block">python-hawkey</div>
                                                            <div id="libhif" class="dnf-diagram-block">libhif</div>
                                                        </div>
                                                    </div>
                                                    <div id="dnf-plugins" class="dnf-diagram-block">plugins</div>
                                                    <div id="dnf" class="dnf-diagram-block">dnf</div>
                                                    <div id="microdnf" class="dnf-diagram-block">microdnf</div>
                                                    <div id="packagekit" class="dnf-diagram-block">PackageKit</div>
                                                    <div id="libdnf-plugins" class="dnf-diagram-block">plugins</div>
                                                </div>
                                                <div id="dnf_dnf-plugins" class="dnf-diagram-line"></div>
                                                <div id="dnf_python-hawkey" class="dnf-diagram-line"></div>
                                                <div id="python-hawkey_hawkey" class="dnf-diagram-line"></div>
                                                <div id="microdnf_hawkey" class="dnf-diagram-line"></div>
                                                <div id="packagekit_hawkey" class="dnf-diagram-line"></div>
                                                <div id="libhif_microdnf" class="dnf-diagram-line"></div>
                                                <div id="libhif_packagekit" class="dnf-diagram-line"></div>
                                                <div id="libhif_libdnf-plugins" class="dnf-diagram-line"></div>
                                            </div>
                                            <h1 style="margin: auto;">DNF5</h1>
                                        </div>
                                    </section>

                                    <section data-auto-animate data-auto-animate-duration="0.5">
                                        <div class="r-stack">
                                            <div data-id="dnf5-diagram">
                                                <div id="dnf-diagram-grid">
                                                    <div data-id="libdnf-block" id="libdnf" class="dnf-diagram-block" style="z-index: 1;">
                                                        <div id="libdnf-grid">
                                                            <div id="libdnf-label" style="visibility: hidden;"><b>LIBDNF5</b></div>
                                                            <div id="hawkey" class="dnf-diagram-block" style="visibility: hidden;">hawkey</div>
                                                            <div id="python-hawkey" class="dnf-diagram-block" style="visibility: hidden;">python-hawkey</div>
                                                            <div id="libhif" class="dnf-diagram-block" style="visibility: hidden;">libhif</div>
                                                        </div>
                                                    </div>
                                                    <div id="dnf5-plugins" class="dnf-diagram-block">plugins</div>
                                                    <div id="dnf" class="dnf-diagram-block">dnf5</div>
                                                    <div id="microdnf" class="dnf-diagram-block">daemon</div>
                                                    <div id="packagekit" class="dnf-diagram-block" style="visibility: hidden;">PackageKit</div>
                                                    <div id="libdnf-plugins" class="dnf-diagram-block">plugins</div>
                                                </div>
                                                <div id="dnf_dnf-plugins" class="dnf-diagram-line"></div>
                                                <div id="libdnf_microdnf" class="dnf-diagram-line"></div>
                                                <div id="libdnf_dnf" class="dnf-diagram-line"></div>
                                                <div id="libdnf_libdnf-plugins" class="dnf-diagram-line"></div>
                                            </div>
                                            <h1 style="margin: auto; z-index: 1;">LIBDNF5</h1>
                                        </div>
                                    </section>
                                </section>

                                <section>
                                    <section>
                                        <img data-src="img/tech/cat_meme.jpg" style="width: 50%;">
                                    </section>

                                    <section style="text-align: left;">
                                        <h4>Basically full rewrite: API not compatible</h4>
                                        <ul>
                                            <li class="fragment fade-up">API is safer and unified</li>
                                            <li class="fragment fade-up">SWIG bindings for: <span class="fragment fade-up"><b>Python, </b></span><span class="fragment fade-up">Perl, Ruby, <span style="opacity: 20%;">Go</span></span></li>
                                        </ul>
                                        <br><br>
                                        <h4 class="fragment fade-up">DNF5 CLI commands are mostly the same</h4>
                                        <ul>
                                            <li class="fragment fade-up">DNF CI tests are the same for DNF5</li>
                                            <li class="fragment fade-up">Outputs of commands did change</li>
                                        </ul>
                                    </section>

                                    <section style="text-align: left;">
                                        <h4>Fewer dependencies</h4>
                                        <ul>
                                            <li class="fragment fade-up">No Python required</li>
                                        </ul>
                                        <br><br>
                                        <h4 class="fragment fade-up">Performance</h4>
                                        <ul>
                                            <li class="fragment fade-up">Everything is faster</li>
                                            <li class="fragment fade-up">Repos download and loading at the same time (also no filelists)</li>
                                        </ul>
                                        <br><br>
                                        <h4 class="fragment fade-up">DNF5 daemon</h4>
                                        <ul>
                                            <li class="fragment fade-up">Same functionality as dnf5 provded by D-Bus</li>
                                        </ul>
                                    </section>

                                    <section>
                                        <h4>List of additional DNF5 improvements:</h4>
                                        <ul>
                                            <li class="fragment fade-up">Configurable aliases</li>
                                            <li class="fragment fade-up">Fully integrated Modularity in LIBDNF5 workflows</li>
                                            <li class="fragment fade-up">Shared configurations</li>
                                            <li class="fragment fade-up">Separation of system state from history DB and module state</li>
                                            <li class="fragment fade-up">Autocomplete build in</li>
                                            <li class="fragment fade-up">...</li>
                                        </ul>
                                    </section>
                                </section>


                                <section>
                                    <section>
                                        <h2>Community</h2>
                                        <p class="fragment fade-left">The Upstream: <a href="https://github.com/rpm-software-management/dnf5">rpm-software-management/dnf5</a></p>
                                    </section>
                                    <section>
                                        <h4>How do we plan to work closer with the community?</h4>
                                        <ul>
                                            <li class="fragment fade-up">Looking at the past of the project</li>
                                            <li class="fragment fade-up">Looking at the future of our contributors</li>
                                            <li class="fragment fade-up">Our action items</li>
                                        </ul>
                                    </section>
                                </section>
                                <section>
                                    <section data-auto-animate>
                                        <h4>Looking at the past of the projects</h4>
                                    </section>
                                    <section data-auto-animate data-auto-animate-duration="0.5" id="where-are-we-now">
                                        <h4>Looking at the past of the projects</h4>
                                        <div id="where-are-we-now">
                                        <img class="crop-graph" src="img/community/bimonthly_contrib.png" />
                                        </div>
                                    </section>
                                    <section>
                                        <h4>Very few people are doing all the work</h4>
                                        <img class="crop-graph" src="img/community/authors_per_contributions.png" />
                                    </section>
                                    <section>
                                        <h4>How the efforts are shifting from 2022</h4>
                                        <img class="crop-graph" src="img/community/commits_in_2022.png" />
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <h4>LIBDNF (2012-today)</h4>
                                        <img class="crop-graph" src="img/community/contributions_per_author_libdnf.png" />
                                    </section>
                                    <section>
                                        <h4>DNF5 (2020-tomorrow?)</h4>
                                        <img class="crop-graph" src="img/community/contributions_per_author_dnf5.png" />
                                    </section>
                                    <section>
                                        <h4>DNF (2012-today)</h4>
                                        <img class="crop-graph" src="img/community/contributions_per_author_dnf.png" />
                                    </section>
                                </section>
                                <section>
                                    <section data-auto-animate>
                                        <h4>Where do we want to go? Looking at the future of our contributors</h4>
                                    </section>
                                    <section data-auto-animate data-auto-animate-duration="0.5" id="where-do-we-want-to-go">
                                        <h4>Where do we want to go? Looking at the future of our contributors</h4 >
                                        <div data-id="where-do-we-want-to-go">
                                        <ul>
                                            <li>💻 Authors, Owners ~10% commits</li>
                                            <li class="fragment fade-in" data-fragment-index="1">👏 Co-Authors, Paid programmers ~100 commits</li>
                                            <li class="fragment fade-left" data-fragment-index="3"><b>🤔: The People in the Middle</b></li>
                                            <li class="fragment fade-up" data-fragment-index="2">🧩:Beginners, one timers</li>
                                        </ul>
                                        </div>
                                    </section>
                                    <section>
                                        <h4>DNF Weekly Contribuitons</h4>
                                        <table>
                                            <tr>
                                                <th></th>
                                                <th>All (225)</th>
                                                <th>💻 4 (1.7%)</th>
                                                <th>👏 19 (8%)</th>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td></td>
                                                <td>9347</td>
                                                <td>3944</td>
                                                <td>1156</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 1%</td>
                                                <td>~80</td>
                                                <td>~40</td>
                                                <td>~11</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 5%</td>
                                                <td>~500</td>
                                                <td>~190</td>
                                                <td>~50</td>
                                            </tr>
                                        </table>
                                    </section>
                                    <section>
                                        <h4>DNF5 Weekly Contributions</h4>
                                        <table>
                                            <tr>
                                                <th></th>
                                                <th>All (19)</th>
                                                <th>💻 5 (26%)</th>
                                                <th>👏 6 (31%)</th>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td></td>
                                                <td>1981</td>
                                                <td>336</td>
                                                <td>197</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 1%</td>
                                                <td>~20</td>
                                                <td>~&lt;4</td>
                                                <td>~&lt;2</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 5%</td>
                                                <td>~100</td>
                                                <td>~16</td>
                                                <td>~10 </td>
                                            </tr>
                                        </table>
                                    </section>
                                    <section>
                                        <h4>LIBDNF Weekly Contributions</h4>
                                        <table>
                                            <tr>
                                                <th></th>
                                                <th>All (95)</th>
                                                <th>💻 3 (3%)</th>
                                                <th>👏 8 (8%)</th>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td></td>
                                                <td>3140</td>
                                                <td>1597</td>
                                                <td>1005</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 1%</td>
                                                <td>32</td>
                                                <td>18</td>
                                                <td>10</td>
                                            </tr>
                                            <tr class="fragment fade-up">
                                                <td>To be in 5%</td>
                                                <td>150</td>
                                                <td>83</td>
                                                <td>50 </td>
                                            </tr>
                                        </table>
                                    </section>
                                </section>
                                <section>
                                    <section style="text-align: left;">
                                        <h4>Action Items: transparent workflow...</h4>
                                        <ul>
                                            <li class="fragment fade-left">Issues:
                                                <span class="fragment fade-left">triaged weekly,</span>
                                                <span class="fragment fade-left">divided in milestones</span>
                                            </li>
                                            <li class="fragment fade-left">Discussions:
                                                <span class="fragment fade-left">opinions,</span>
                                                <span class="fragment fade-left">announcements,</span>
                                                <span class="fragment fade-left">questions</span>
                                            </li>
                                            <li class="fragment fade-left">Bugzilla:
                                                <span class="fragment fade-left">bug tracking,</span>
                                                <span class="fragment fade-left">downstream requests</span>
                                            </li>
                                        </ul>
                                    </section>
                                    <section style="text-align: left;">
                                        <h4>Discussions</h4>
                                        <span class="fragment fade-left">
                                            <p>Community opinions</p>
                                            <img src="img/community/discussion-name.png" />
                                        </span>
                                        <span class="fragment fade-left">
                                            <p>Announcements</p>
                                            <img src="img/community/discussion-announcement.png" />
                                        </span>
                                        <span class="fragment fade-left">
                                            <p>Questions from the community</p>
                                            <img src="img/community/discussion-releasever.png" />
                                        </span>
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <h4>...in addition</h4>
                                        <ul>
                                            <li class="fragment fade-left">Documentation:
                                                <span class="fragment fade-left">generated from codebase,</span>
                                                <span class="fragment fade-left">tested,</span>
                                                <span class="fragment fade-left">includes code templates and tutorials</span>
                                            </li>
                                            <li class="fragment fade-left">Contributing guides:
                                                <span class="fragment fade-left">first time issues</span>
                                            </li>
                                        </ul>
                                    </section>
                                    <section>
                                        <h4>So, who is the community?</h4>
                                        <ul>
                                            <li class="fragment fade-left">People who
                                                <span class="fragment fade-left">create issues,</span>
                                                <span class="fragment fade-left">add code,</span>
                                                <span class="fragment fade-left">take part in discussions</span>
                                            </li>
                                            <li class="fragment fade-left">People who
                                                <span class="fragment fade-left">raise questions,</span>
                                                <span class="fragment fade-left">use dnf5</span>
                                            </li>
                                            <li class="fragment fade-left">People who
                                                <span class="fragment fade-left">help,</span>
                                                <span class="fragment fade-left">ask for help</span>
                                            </li>
                                        </ul>
                                    </section>
                                </section>
                                <section>
                                    <section>
                                        <h2>Live DEMO</h2>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>CLI DEMO</h4>
                                        <div style="display: flex;">
                                            <div style="flex: 50%;">
                                                <p>DNF</p>
                                            </div>
                                            <div style="flex: 50%;">
                                                <p>DNF5</p>
                                            </div>
                                        </div>
                                        <div style="display: flex; height: 490px; overflow: hidden;">
                                            <div style="flex: 50%; overflow: hidden;">
                                                <iframe src="http://localhost:6125" style="max-width: 104%; width: 104%; height: 100%;"></iframe>
                                            </div>
                                            <div style="flex: 50%; overflow: hidden;">
                                                <iframe src="http://localhost:6126" style="max-width: 104%; width: 104%; height: 100%;"></iframe>
                                            </div>
                                        </div>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>API DEMO 1</h4>
                                        <pre style="font-size: 20px; width: 100%; max-height: 474px; height: 474px;">
                                            <code class="hljs language-python" data-trim data-line-numbers="|1-4|6-11|13-16|18|">
from libdnf5 import *

my_base = base.Base()
history = transaction.TransactionHistory(my_base)

ts_cond = lambda ts: \
    ts.get_state() == transaction.TransactionState_OK

pkg_cond = lambda pkg: \
    pkg.get_action() == transaction.TransactionItemAction_INSTALL and \
    pkg.get_repoid() == 'updates'

pkgs = []
for ts in filter(ts_cond, history.list_all_transactions()):
    for pkg in filter(pkg_cond, ts.get_packages()):
        pkgs.append(pkg.to_string())

print(*sorted(pkgs), sep='\n')
                                            </code>
                                        </pre>
                                        <iframe src="http://localhost:6127" style="max-width: 100%; width: 100%; height: 80px;"></iframe>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>API DEMO 2</h4>
                                        <pre style="font-size: 18px; width: 100%; max-height: 494px; height: 494px;">
                                            <code class="hljs language-python" data-trim data-line-numbers="|3-4|6-8|10-12|14-17|19-21|">
from libdnf5 import *

my_base = base.Base()
my_base.setup()

sack = my_base.get_repo_sack()
sack.create_repos_from_system_configuration()
sack.update_and_load_enabled_repos(False)

goal = base.Goal(my_base)
goal.add_rpm_install("zlib")
ts = goal.resolve()

downloader = repo.PackageDownloader()
for pkg in ts.get_transaction_packages():
    if base.transaction.transaction_item_action_is_inbound(pkg.get_action()):
        downloader.add(pkg.get_package(), "download")

print("Download started ...")
downloader.download(True, True)
print("Download finished.")

                                            </code>
                                        </pre>
                                        <iframe src="http://localhost:6127" style="max-width: 100%; width: 100%; height: 40px;"></iframe>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Interactive console</h4>
                                        <div style="height: 600px;">
                                            <iframe src="http://localhost:6128" style="width: 100%; height: 100%;"></iframe>
                                        </div>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p class="fragment">What do we need?</p>
                                        <ul>
                                            <li class="fragment fade-up">Devel and bindings packages</li>
                                            <li class="fragment fade-up">Template sources</li>
                                            <li class="fragment fade-up">Build tools (f.e. CMake)</li>
                                        </ul>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>How to write it?</p>
                                        <ul>
                                            <li class="fragment fade-up">Definition</li>
                                            <li class="fragment fade-up">Implementation</li>
                                            <li class="fragment fade-up">Adapter A.K.A. boilerplate</li>
                                        </ul>
                                    </section>

                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>Implementation</p>
                                        <pre style="font-size: 16px; width: 100%; max-height: 512px; height: 512px;">
                                            <code class="hljs language-cpp" data-trim data-line-numbers="|9-12|15-17|19-21|23-25|">
<script type="text/template">
#include "example.hpp"

#include <iostream>

namespace dnf5 {

using namespace libdnf::cli;

void ExampleCommand::set_parent_command() {
    auto parent_command = get_session().get_argument_parser().get_root_command();
    auto this_command = get_argument_parser_command();
    parent_command->register_command(this_command);
}

void ExampleCommand::set_argument_parser() {
    get_argument_parser_command()->set_description("Example command");
}

void ExampleCommand::configure() {
    get_context().set_quiet(true);
}

void ExampleCommand::run() {
    std::cout << "YES !!! We did it!" << std::endl;
}
</script>
                                            </code>
                                        </pre>
                                    </section>
                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>Adapter</p>
                                        <pre style="font-size: 16px; width: 100%; max-height: 512px; height: 512px;">
                                            <code class="hljs language-cpp" data-trim data-line-numbers="|9-13|41-44|61-65">
<script type="text/template">
#include "example.hpp"

#include <dnf5/iplugin.hpp>

using namespace dnf5;

namespace {

constexpr const char * PLUGIN_NAME{"example"};
constexpr PluginVersion PLUGIN_VERSION{.major = 1, .minor = 0, .micro = 0};

constexpr const char * attrs[]{"author.name", "author.email", "description", nullptr};
constexpr const char * attrs_value[]{"Some Excited Guy", "sponsor@dnf5.com", "example"};

class ExamplePlugin : public IPlugin {
public:
    using IPlugin::IPlugin;

    PluginAPIVersion get_api_version() const noexcept override { return PLUGIN_API_VERSION; }

    const char * get_name() const noexcept override { return PLUGIN_NAME; }

    PluginVersion get_version() const noexcept override { return PLUGIN_VERSION; }

    const char * const * get_attributes() const noexcept override { return attrs; }

    const char * get_attribute(const char * attribute) const noexcept override {
        for (size_t i = 0; attrs[i]; ++i) {
            if (std::strcmp(attribute, attrs[i]) == 0) {
                return attrs_value[i];
            }
        }
        return nullptr;
    }

    std::vector<std::unique_ptr<Command>> create_commands() override;

    void finish() noexcept override {}
};

std::vector<std::unique_ptr<Command>> ExamplePlugin::create_commands() {
    std::vector<std::unique_ptr<Command>> commands;
    commands.push_back(std::make_unique<ExampleCommand>(get_context()));
    return commands;
}

}

PluginAPIVersion dnf5_plugin_get_api_version(void) {
    return PLUGIN_API_VERSION;
}

const char * dnf5_plugin_get_name(void) {
    return PLUGIN_NAME;
}

PluginVersion dnf5_plugin_get_version(void) {
    return PLUGIN_VERSION;
}

IPlugin * dnf5_plugin_new_instance(ApplicationVersion version, Context & context) try {
    return new ExamplePlugin(context);
} catch(...) {
    return nullptr;
}

void dnf5_plugin_delete_instance(IPlugin * plugin_object) {
    delete plugin_object;
}
</script>
                                            </code>
                                    </section>
                                    <section data-auto-animate>
                                        <h4>Deploying a simple DNF5 plugin</h4>
                                        <p>Build it & run it!</p>
                                        <div style="height: 500px;">
                                            <iframe src="http://localhost:6129" style="width: 100%; height: 100%;"></iframe>
                                        </div>
                                    </section>
                            </section>
                            <section>
                                <section data-auto-animate>
                                    <h4>Thank you for joining us!</h4>
                                    <img data-src="img/end/waiting.jpg" style="width: 60%;" />
                                </section>
                                <section data-auto-animate data-auto-animate-duration="0.5" id="thank-you">
                                    <h4>Thank you for joining us!</h4>
                                    <p>Where are we?</p>
                                    <table class="smaller">
                                        <tr>
                                            <th></th>
                                            <th>Link</th>
                                        </tr>
                                        <tr>
                                            <td>GitHub Repo</td>
                                            <td>
                                                <a href="https://github.com/rpm-software-management/dnf5" target="_blank">
                                                    https://github.com/rpm-software-management/dnf5
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>GitHub Issues</td>
                                            <td>
                                                <a href="https://github.com/rpm-software-management/dnf5/issues" target="_blank">
                                                    https://github.com/rpm-software-management/dnf5/issues
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>GitHub discussions</td>
                                            <td>
                                                <a href="https://github.com/rpm-software-management/dnf5/discussions" target="_blank">
                                                    https://github.com/rpm-software-management/dnf5/discussions
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Documentation</td>
                                            <td>
                                                <a href="https://dnf5.readthedocs.io/en/latest/" target="_blank">
                                                    https://dnf5.readthedocs.io
                                                </a>
                                            </td>
                                        </tr>
                                    </table>
                                    <p>How to try dnf5?</>
                                    <table class="smaller">
                                        <tr>
                                            <th>Where</th>
                                            <th>How</th>
                                        </tr>
                                        <tr>
                                            <td> Fedora 36/37</td>
                                            <td>
                                                <code class="hljs language-bash">
                                                    dnf copr enable rpmsoftwaremanagement/dnf5-unstable
                                                </code>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Fedora 38</td>
                                            <td>
                                                <code class="hljs language-bash">
                                                    dnf install dnf5
                                                </code>
                                            </td>
                                        </tr>
                                    </table>
                                </section>
                            </section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>

        <!-- Custom scripts -->
        <script src="custom/jquery-latest.min.js"></script>
        <script src="custom/leader-line.min.js"></script>
        <script src="custom/diagram.js"></script>

		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/

            var pkgMgrLines = [];

			Reveal.initialize({
				hash: true,
                showSlideNumber: 'speaker',
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});

            Reveal.configure({
                pdfSeparateFragments: false
            });
            
            Reveal.on('slidechanged', event => {
                if (event.currentSlide.id == 'pkg-mgr-diagram-slide') {
                    packageManagerDiagramInit();
                } else {
                    pkgMgrLines.forEach(line => {
                        line.hide('none');
                    });
                }
            });

            // Initialize diagrams
            Reveal.on('dnf-diagram', () => {
                dnfDiagramInit();
            });
		</script>
	</body>
</html>
